# For most projects, this workflow file will not need changing; you simply need
# to commit it to your repository.
#
# You may wish to alter this file to override the set of languages analyzed,
# or to provide custom queries or build logic.
#
# ******** NOTE ********
# We have attempted to detect the languages in your repository. Please check
# the `language` matrix defined below to confirm you have the correct set of
# supported CodeQL languages.
#
name: "CodeQL"

on:
  push:
    branches: [ "main" ]
  pull_request:
    # The branches below must be a subset of the branches above
    branches: [ "main" ]
  schedule:
    - cron: '22 19 * * 5'

jobs:
  analyze:
    name: Analyze
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read
      security-events: write

    strategy:
      fail-fast: false
      matrix:
        language: [ 'javascript' ]
        # CodeQL supports [ 'cpp', 'csharp', 'go', 'java', 'javascript', 'python', 'ruby' ]
        # Learn more about CodeQL language support at https://aka.ms/codeql-docs/language-support

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    # Initializes the CodeQL tools for scanning.
    - name: Initialize CodeQL
      uses: github/codeql-action/init@v2
      with:
        languages: ${{ matrix.language }}
        # If you wish to specify custom queries, you can do so here or in a config file.
        # By default, queries listed here will override any specified in a config file.
        # Prefix the list here with "+" to use these queries and those in the config file.
        
        # Details on CodeQL's query packs refer to : https://docs.github.com/en/code-security/code-scanning/automatically-scanning-your-code-for-vulnerabilities-and-errors/configuring-code-scanning#using-queries-in-ql-packs
        # queries: security-extended,security-and-quality

        
    # Autobuild attempts to build any compiled languages  (C/C++, C#, or Java).
    # If this step fails, then you should remove it and run the build manually (see below)
    - name: Autobuild
      uses: github/codeql-action/autobuild@v2

    # ‚ÑπÔ∏è Command-line programs to run using the OS shell.
    # üìö See https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstepsrun

    #   If the Autobuild fails above, remove it and uncomment the following three lines. 
    #   modify them (or add more) to build your code if your project, please refer to the EXAMPLE below for guidance.

    # - run: |
    #   echo "Run, Build Application using script"
    #   ./location_of_script_within_repo/buildscript.sh

    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v2

    - name: Cache
      uses: actions/cache@v3.0.8
      with:
        # A list of files, directories, and wildcard patterns to cache and restore
    path: 
        # An explicit key for restoring and saving the cache
    key: 
        # An ordered list of keys to use for restoring stale cache if no cache hit occurred for key. Note `cache-hit` returns false in this case.
    restore-keys: # optional
        # The chunk size used to split up large files during upload, in bytes
    upload-chunk-size: # optional
    
    
    - name: Harden Runner
   # You may pin to the exact commit or the version.
    # uses: step-security/harden-runner@dd2c410b088af7c0dc8046f3ac9a8f4148492a95
    uses: step-security/harden-runner@v1.4.5
    with:
    # Only these endpoints will be allowed if egress-policy is set to block
    allowed-endpoints: # optional, default is 
    # Policy for outbound traffic, can be either audit or block
    egress-policy: # optional, default is block
    # Used to avoid github rate limiting
    token: # optional, default is ${{ github.token }}
    # Disable sending telemetry to StepSecurity API, can be set to true or false. This can only be set to true when egress-policy is set to block
    disable-telemetry: # optional, default is false
    
    - name: Install Geth (Go Ethereum) and tools
    # You may pin to the exact commit or the version.
    # uses: gacts/install-geth-tools@ddd0fd0bd4b03f2789da1cf51c758e725c20a70f
    uses: gacts/install-geth-tools@v1.0.0
    with:
    # Geth version
    version: # default is latest
    # GitHub auth token. Since there's a default, this is typically not supplied by the user
    github-token: # optional, default is ${{ github.token }}
    
    - name: Web3 Storage Pinning GitHub Action
    # You may pin to the exact commit or the version.
    # uses: saeta-eth/web3storage-pinning-action@a48892324ad7ccfaa26ddbc32889225292f486b6
    uses: saeta-eth/web3storage-pinning-action@v1.0.0
    with:
    # Ipfs cid to be pinned on Web3.Storage
    cid: 
    # Name of pin
    pin_name: 
    # API Token for Web3.Storage
    web3_storage_api_token: 
    
    - name: NPM-Version-Date
    # You may pin to the exact commit or the version.
    # uses: polygon-software/npm-version-date@9bad89176240ee1d76a4d06d30d4777dbc4e0669
    uses: polygon-software/npm-version-date@1
    with:
    # Date schema based on [date-fns format](https://date-fns.org/v2.21.3/docs/format)
    schema: 
    # Major version number. Must only be provided if 'V' is used within the schema.
    V: # optional, default is 1
    # If set to true, the patch version from the current package-json will be increased
    increase-patch: # optional, default is false
    
    - name: Compress Picture Action
    # You may pin to the exact commit or the version.
    # uses: aliasmee/compress-pic@7bcf734825967e9dab8458ad36223a8a5401f8fb
    uses: aliasmee/compress-pic@v0.0.1-fix
    with:
    # The switches
    switches: # optional, default is 
    # The pic location path
    pic_path: # optional, default is 
    # Compress optimization level(0-7), defailt 2
    compress_level: # optional, default is 2
    
    - name: Json Schema Action: Compression
    # You may pin to the exact commit or the version.
    # uses: DaanV2/Json-Schema-Action-Compression@eac730177357b3dcc01e7c39fef09702d5b9f15d
    uses: DaanV2/Json-Schema-Action-Compression@v2.1
    with:
    # The filepath to the specification file
    specificationFile: 
    
    - name: Image Optimizer
    # You may pin to the exact commit or the version.
    # uses: crush-pics/crush-pics-github-action@43ce9e319a61c10d7438da324515336caee56492
    uses: crush-pics/crush-pics-github-action@v1.0
    
    - name: WebP Optimizer Actions
    # You may pin to the exact commit or the version.
    # uses: nemeaXYZ/webp-optimizer@07420a6d12022a71ea64a555057b408fecf677a5
    uses: nemeaXYZ/webp-optimizer@v1.0.0-alpha
    with:
    # GitHub Token
    githubToken: 
    # WEBP quality level
    webpQuality: # optional, default is 80
    # Paths to ignore during search
    ignorePaths: # optional, default is node_modules/**
    
    - name: Graph Deploy
    # You may pin to the exact commit or the version.
    # uses: gtaschuk/graph-deploy@604ee0f1cb7f521ab3a2ec2ba672cc392666bb42
    uses: gtaschuk/graph-deploy@v0.1.9
    with:
    # Your access token to deploy to the graph
    graph_access_token: 
    # The name of the subgraph
    graph_subgraph_name: 
    # The account or organization that the subgraph is owned by
    graph_account: 
    # The config file you will use to deploy
    graph_config_file: # optional, default is subgraph.yml
    # Deploy the subgraph to studio? (true/false)
    graph_deploy_studio: # optional
    
    - name: googlesheet-actions
    # You may pin to the exact commit or the version.
    # uses: rjoydip-zz/googlesheet-actions@20662d6a790e055e6df7ba33e03a050220cc722b
    uses: rjoydip-zz/googlesheet-actions@0.1.1
    with:
    # google sheet id
    sheet-id: 
    
    - name: Google Spreadsheet - CSV importer
    # You may pin to the exact commit or the version.
    # uses: canonical-web-and-design/csv-to-google-spreadsheet@69b0f486c8a5b7e8738aa4df5ff388d0cc9dbc3d
    uses: canonical-web-and-design/csv-to-google-spreadsheet@1.0.0
    with:
    # 
    csv_path: 
    # 
    spreadsheet_id: 
    # Index of worksheet in Spreadsheet. Index starts from zero.
    worksheet: # default is 0
    # 
    append_content: # optional
    # 
    google_service_account_email: 
    # 
    google_service_account_private_key: 
    
    - name: Write to Google BigQuery
      # You may pin to the exact commit or the version.
      # uses: Staffbase/bigquery-github-action@3e1a770e937938c9aa8a8e038c902848d0bb13ae
      uses: Staffbase/bigquery-github-action@v1.0.1
      with:
        # The credentials key for the Service Account user used for authentication in JSON format.
    This is forwarded to the google-github-actions/auth@v0 action.
        credentials_json: 
        # The lifetime of the generated auth token in seconds. The default is 30s.
    This is forwarded to the google-github-actions/auth@v0 action.
    token_lifetime: # optional, default is 30s
    # The Project ID of the project to write to.
    bigquery_project: 
    # The Dataset ID inside the project to write to.
    bigquery_dataset: 
    # The Table ID inside the dataset to write to.
    bigquery_table: 
    # The payload to be written into the referenced table in JSON format. It must reflect the schema of the table.
    payload_json: 
    
    - name: Docker Cloud Build
  # You may pin to the exact commit or the version.
  # uses: FlowSquad/docker-cloud-build@542c635f7e209741a9ef16802818102ccecda373
  uses: FlowSquad/docker-cloud-build@v1.0.1
  with:
    # The GCP Project ID to use.
    gcp-project-id: 
    # Base64-encoded key file to use to authenticate against Google Cloud Services.
    gcp-service-account-key: 
    # Google Cloud Storage Bucket used to temporarily store build input files. If not specified, the default value is ${gcp-project-id}_cloudbuild.
    gcp-cloud-storage-bucket: # optional
    # The Google Container Registry region to use (gcr.io, us.gcr.io, eu.gcr.io, asia.gcr.io). Defaults to eu.gcr.io.
    gcp-gcr-region: # optional
    # The name of the built image.
    image-name: 
    # A comma-separated list of files and folders to use as build source. Patterns such as * and ** are supported. Paths are relative to the repository root. All matched files and folders are copied to a common directory before being passed to Cloud Build.
    image-sources: 
    # The format to tag the built image with, if the build was caused by a commit. Builds caused by a tag are always labelled with that tag. The format string can contain the following list of parameters. All other parts of the string are treated as constants. Make sure you only use characters allowed in a docker tag. Defaults to "$BRANCH-$SHA-$YYYY.$MM.$DD-$HH.$mm.$SS", for example "main-4e83ab-2021.04.22-09.08.12". Time is based on the server timezone. $BRANCH     The branch name, normalized. $SHA        The 7-digit SHA of the commit $YYYY       The year in 4-digit format $MM         The month in 2-digit format $DD         The day in 2-digit format $HH         The hour in 2-digit format (24h) $mm         The minute in 2-digit-format $SS         The second in 2-digit-format
    image-tag-format: # optional
    # Whether the built image will be tagged with latest. Defaults to false.
    image-tag-latest: # optional
    # Whether the built image will be tagged with ${branchName}-latest. Defaults to false.
    image-tag-branch-latest: # optional
    # A comma-separated list of additional tags to use for the built image. Defaults to false.
    image-tag-additional-tags: # optional
    # Token to use to set the commit status. The token is required unless ${github-disabled} is true.
    github-token: # optional
    # Whether to disable all GitHub integrations. Defaults to false.
    github-disabled: # optional
    # Whether to disable setting the commit status to the name and tags of the built docker images. Defaults to false.
    github-commit-status-disabled: # optional
    # Whether to put all image tags into separate commit status entry. If false, only the primary tag will be added. Defaults to false.
    github-commit-status-all: # optional
    # The format in which the built images will be displayed. Can be one of the following values. Defaults to small. - large     host/project/image:tag    eu.gcr.io/flowsquad-io/test-image:latest - medium    project/image:tag         flowsquad-io/test-image:latest - small     image:tag                 test-image:latest - tiny      tag                       latest
    github-commit-status-description: # optional
    # The title to use for the commit status. Will be suffixed with an index when github-commit-status-all is true. Defaults to "Docker Image".
    github-commit-status-title: # optional
    # Whether to disable updating the release information with the built docker images. Defaults to false.
    github-release-information-disabled: # optional
    # Whether to add all built image tags to the list of images. Else only the image tagged with the release tag will be added. Defaults to false.
    github-release-information-all: # optional
    
    - name: Sync DAGs to Composer
    # You may pin to the exact commit or the version.
    # uses: cristian-rincon/action-composer-sync@ba704a69b1bfad7332045c49267beaa51c616ed5
    uses: cristian-rincon/action-composer-sync@v0.1.0
    with:
    # GCP service account key
    GOOGLE_APPLICATION_CREDENTIALS: 
    # GCP project ID
    PROJECT_ID: 
    # Cloud Composer environment name
    ENVIRONMENT: 
    # Cloud Composer environment location
    LOCATION: 
    # DAGs folder
    DAG_NAME: 
    
    - name: GCP Storage
  # You may pin to the exact commit or the version.
  # uses: convictional/gcp-storage-action@af2d59de0d9dda46152591b3801b9b5109ef78f8
  uses: convictional/gcp-storage-action@v0.1.1
  with:
    # The file path that the file will be sourced from. This can be either a local file or GCP storage file. GCP storage file should lead with gs://.
    source_file: 
    # The file path that the file will be uploaded to. This can be either a local file or GCP storage file.
    destination_file: 
    # These are the IAM credentials for accessing the GCP bucket.
    application_credentials: # optional
    # The project id that the bucket lives under.
    project_id: # optional
    # The action to be performed. This defaults to cp and isnt implemented yet.
    action: # optional
    # Additional flags to be passed in.
    flags: # optional
